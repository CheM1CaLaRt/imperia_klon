{% load access %}
{% load static %}
<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>{% block title %}Imperia{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

 <style>

  /* ====== –¢–µ–º–∞ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ====== */
  :root{
    color-scheme: light;
    --bg:#F2F2F7;
    --card:#FFFFFF;
    --text:#1C1C1E;
    --muted:#6E6E73;
    --border:rgba(60,60,67,.12);
    --primary:#0A84FF; --primary-600:#0077ED;
    --ring:rgba(10,132,255,.22);
    --shadow:0 8px 18px rgba(0,0,0,.06);
    --r-md:14px; --r-lg:18px; --pad:20px;

    /* –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –±–æ–∫–æ–≤—ã–µ –æ—Ç—Å—Ç—É–ø—ã */
    --container:1280px;
    --gutter-x:24px;
  }
  @media (min-width:1600px){
    :root{ --container:1440px; --gutter-x:32px; }
  }
  @media (max-width:940px){
    :root{ --gutter-x:16px; }
  }

  html,body{height:100%}
  *{box-sizing:border-box}
  body{
    margin:0; min-height:100vh; display:flex; flex-direction:column;
    background:var(--bg); color:var(--text);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Noto Sans","Helvetica Neue",Arial,sans-serif;
    font-size:16px;
  }
  a{color:inherit; text-decoration:none}

  /* Topbar */
  .topbar{position:sticky;top:0;z-index:100;background:rgba(255,255,255,.98);
          backdrop-filter:saturate(180%) blur(20px);-webkit-backdrop-filter:saturate(180%) blur(20px);
          border-bottom:1px solid var(--border);box-shadow:0 2px 8px rgba(0,0,0,.04)}
  .topbar-inner{display:flex;align-items:center;justify-content:space-between;
                max-width:var(--container);margin:0 auto;padding:14px var(--gutter-x);gap:16px;flex-wrap:nowrap}

  /* Brand Logo - —É–ª—É—á—à–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω */
  .brand-logo-wrapper{
    width:48px;height:48px;border-radius:16px;
    background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display:flex;align-items:center;justify-content:center;
    box-shadow:0 4px 16px rgba(102,126,234,0.25), inset 0 1px 0 rgba(255,255,255,0.2);
    transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position:relative;overflow:hidden;
  }
  .brand-logo-wrapper::before{
    content:'';position:absolute;top:0;left:0;right:0;bottom:0;
    background:linear-gradient(135deg, rgba(255,255,255,0.2) 0%, transparent 100%);
    opacity:0;transition:opacity 0.3s ease;
  }
  .brand-logo-wrapper:hover{
    transform:translateY(-2px) scale(1.05);
    box-shadow:0 6px 20px rgba(102,126,234,0.35), inset 0 1px 0 rgba(255,255,255,0.3);
  }
  .brand-logo-wrapper:hover::before{opacity:1}
  .brand-logo-wrapper:active{transform:translateY(0) scale(0.98)}
  .brand-logo-wrapper img{
    width:32px;height:32px;object-fit:contain;
    filter:drop-shadow(0 2px 4px rgba(0,0,0,0.15));
    position:relative;z-index:1;
    transition:transform 0.3s ease;
  }
  .brand-logo-wrapper:hover img{transform:scale(1.1)}

  /* NAV - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ 2025 */
  .nav{display:flex;align-items:center;gap:6px;margin-left:16px;flex-wrap:wrap}
  .nav a{
    padding:10px 18px;border-radius:12px;font-weight:600;font-size:14px;
    white-space:nowrap;position:relative;overflow:hidden;
    transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    background:transparent;color:var(--text);
    border:1px solid transparent;
  }
  .nav a::before{
    content:'';position:absolute;top:50%;left:50%;width:0;height:0;
    border-radius:50%;background:rgba(10,132,255,0.08);
    transform:translate(-50%, -50%);transition:width 0.6s ease, height 0.6s ease;
  }
  .nav a:hover::before{width:200%;height:200%}
  .nav a:hover{
    background:rgba(10,132,255,0.06);color:var(--primary);
    transform:translateY(-1px);
    box-shadow:0 4px 12px rgba(10,132,255,0.15);
    border-color:rgba(10,132,255,0.2);
  }
  .nav a:active{transform:translateY(0);box-shadow:0 2px 6px rgba(10,132,255,0.1)}
  .nav a.active{
    background:linear-gradient(135deg, #0A84FF 0%, #0077ED 100%);
    color:#fff;border-color:transparent;
    box-shadow:0 4px 14px rgba(10,132,255,0.3), inset 0 1px 0 rgba(255,255,255,0.2);
    position:relative;
  }
  .nav a.active::after{
    content:'';position:absolute;bottom:0;left:50%;transform:translateX(-50%);
    width:60%;height:2px;background:rgba(255,255,255,0.6);
    border-radius:2px 2px 0 0;
  }
  .nav a.active:hover{
    background:linear-gradient(135deg, #0077ED 0%, #0051A3 100%);
    transform:translateY(-1px);
    box-shadow:0 6px 18px rgba(10,132,255,0.4), inset 0 1px 0 rgba(255,255,255,0.25);
  }
  .nav a span{position:relative;z-index:1}

  /* Mobile Menu Toggle */
  .mobile-menu-toggle{
    display:none;flex-direction:column;gap:5px;padding:10px;
    background:transparent;border:none;cursor:pointer;
    border-radius:10px;transition:background 0.2s ease;
    position:relative;z-index:10000;
  }
  .mobile-menu-toggle:hover{background:rgba(10,132,255,0.08)}
  .mobile-menu-toggle span{
    width:24px;height:2px;background:var(--text);
    border-radius:2px;transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    transform-origin:center;
  }
  .mobile-menu-toggle.active span:nth-child(1){
    transform:translateY(7px) rotate(45deg);
  }
  .mobile-menu-toggle.active span:nth-child(2){
    opacity:0;transform:scaleX(0);
  }
  .mobile-menu-toggle.active span:nth-child(3){
    transform:translateY(-7px) rotate(-45deg);
  }
  .mobile-menu-label{
    font-size:13px;font-weight:600;color:var(--text);
    margin-left:8px;display:none;
  }

  /* User */
  .avatar-sm{width:36px;height:36px;border-radius:50%;object-fit:cover;background:#E9E9EB;
             display:grid;place-items:center;font-weight:700;color:#374151;pointer-events:none;
             box-shadow:inset 0 0 0 1px var(--border)}
  .userbox{position:relative;display:flex;align-items:center;gap:10px}
  .hello{font-size:13px;color:var(--muted)} .name{font-weight:700}
  .userbtn{display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:#fff;
           border:1px solid var(--border);cursor:pointer;transition:box-shadow .15s,border-color .15s,transform .05s}
  .userbtn:hover{border-color:rgba(60,60,67,.18)} .userbtn:active{transform:translateY(1px)}
  .userbtn:focus{outline:none;box-shadow:0 0 0 6px var(--ring)} .caret{font-size:12px;opacity:.6}
  .menu{position:absolute;right:0;top:calc(100% + 8px);background:#fff;border:1px solid var(--border);
        border-radius:18px;box-shadow:var(--shadow);min-width:220px;display:none;overflow:hidden}
  .menu.open{display:block}
  .menu a,.menu button{display:flex;align-items:center;gap:10px;width:100%;padding:12px 14px;background:transparent;
                       border:0;cursor:pointer;font-size:14px;color:var(--text)}
  .menu a:hover,.menu button:hover{background:#EAF2FF;color:#0A84FF}
  .menu a:active,.menu button:active{background:#DDEBFF}

  /* Content */
/* –±–∞–∑–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ */
.wrap{
  flex: 1 0 auto;
  max-width: var(--container);   /* 1280px –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
  margin: 0 auto;
  padding: var(--pad) var(--gutter-x);
  width: 100%;
}

/* –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã ‚Äî –∏–¥—É—Ç –ü–û–°–õ–ï –±–∞–∑–æ–≤–æ–≥–æ –∏ –≤—ã–∏–≥—Ä—ã–≤–∞—é—Ç –ø–æ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ—Å—Ç–∏ */
main.wrap.wrap--xl ~ footer .footer-inner     { max-width: 1440px; }
main.wrap.wrap--xxl ~ footer .footer-inner    { max-width: 1600px; }
main.wrap.wrap--fluid ~ footer .footer-inner  { max-width: min(92vw, 1680px); }

  /* Forms */
  .field{margin:12px 0}
  .field label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
  input[type="text"],input[type="email"],input[type="url"],input[type="tel"],
  input[type="date"],input[type="number"],input[type="password"],textarea,select{
    width:100%;padding:12px 14px;background:#fff;border:1px solid var(--border);border-radius:12px;font-size:15px;line-height:1.35;
    transition:border-color .15s,box-shadow .15s,background .15s}
  textarea{min-height:120px;resize:vertical}
  input:focus,textarea:focus,select:focus{outline:none;border-color:rgba(10,132,255,.45);box-shadow:0 0 0 6px var(--ring)}

  .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;height:42px;padding:0 16px;border-radius:12px;border:1px solid transparent;font-weight:600;cursor:pointer}
  .btn-primary{background:var(--primary);color:#fff;border-color:var(--primary)}
  .btn-primary:hover{background:var(--primary-600)}
  .btn-secondary{background:#F2F3F5;color:#1C1C1E;border:1px solid var(--border)}
  .btn-link{background:transparent;border:0;color:var(--primary);height:auto;padding:0}

  /* Cards */
  .card{background:var(--card);border-radius:var(--r-lg);padding:var(--pad);box-shadow:var(--shadow);border:1px solid var(--border);margin-bottom:20px}
  .card-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;padding-bottom:16px;border-bottom:1px solid var(--border);flex-wrap:wrap;gap:12px}
  .card-title{font-size:24px;font-weight:700;margin:0;color:var(--text)}
  .card-subtitle{font-size:14px;color:var(--muted);margin-top:4px}
  .stat-card{background:var(--card);border-radius:var(--r-lg);padding:20px;box-shadow:var(--shadow);border:1px solid var(--border);text-align:center;transition:transform 0.2s,box-shadow 0.2s}
  .stat-card:hover{transform:translateY(-2px);box-shadow:0 12px 24px rgba(0,0,0,.1)}
  .stat-value{font-size:32px;font-weight:700;color:var(--primary);margin:8px 0}
  .stat-label{font-size:14px;color:var(--muted);text-transform:uppercase;letter-spacing:0.5px}
  
  .grid{display:grid;gap:16px}
  .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:20px}
  .grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:20px}
  .grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:20px}
  
  /* Mobile Navigation */
  @media (max-width:940px){
    .grid-2,.grid-3,.grid-4{grid-template-columns:1fr}
    .topbar-inner{padding:12px var(--gutter-x);flex-wrap:nowrap;position:relative}
    .mobile-menu-toggle{display:flex}
    .mobile-menu-label{display:block}
    .nav{
      position:fixed;top:70px;left:0;right:0;bottom:0;
      background:rgba(255,255,255,0.98);backdrop-filter:blur(20px);
      flex-direction:column;align-items:stretch;gap:8px;
      padding:20px var(--gutter-x);margin:0;
      transform:translateX(-100%);opacity:0;
      transition:transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                 opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      overflow-y:auto;z-index:9999;
      box-shadow:0 4px 24px rgba(0,0,0,0.1);
      pointer-events:none;
    }
    .nav.open{
      transform:translateX(0);opacity:1;
      pointer-events:auto;
    }
    .nav a{
      padding:14px 18px;border-radius:12px;width:100%;
      justify-content:flex-start;display:flex;
      font-size:15px;border:1px solid var(--border);
      background:var(--card);
    }
    .nav a.active{
      border-color:var(--primary);
    }
    .userbox .hello{display:none}
    .stat-value{font-size:28px}
    .card-title{font-size:20px}
    .brand-logo-wrapper{width:44px;height:44px;border-radius:14px}
    .brand-logo-wrapper img{width:30px;height:30px}
  }
  @media (max-width:640px){
    .topbar-inner{padding:10px var(--gutter-x)}
    .nav{padding:16px var(--gutter-x);top:66px}
    .userbox{justify-content:flex-end}
    .userbox .hello{display:none}
    .card{padding:16px}
    .card-title{font-size:18px}
    .stat-card{padding:16px}
    .stat-value{font-size:24px}
    .brand-logo-wrapper{width:40px;height:40px;border-radius:12px}
    .brand-logo-wrapper img{width:28px;height:28px}
  }

  /* Footer */
  .footer{margin-top:auto;background:#fff;border-top:1px solid var(--border)}
  .footer-inner{max-width:var(--container);margin:0 auto;padding:14px var(--gutter-x);
                display:flex;align-items:center;justify-content:space-between;gap:12px;color:var(--muted);font-size:14px}
  .footer a{color:var(--primary);font-weight:600}
  .footer a:hover{text-decoration:underline}
  @media (max-width:940px){.footer-inner{flex-direction:column;align-items:flex-start;gap:6px}}

  /* –†–∞–∑–Ω–æ–µ */
  .profile-header{display:flex;align-items:center;gap:16px;margin:12px 0 20px}
  .avatar{width:88px;height:88px;border-radius:50%;object-fit:cover;background:#E9E9EB;box-shadow:inset 0 0 0 1px var(--border);flex:0 0 88px}
  .avatar--placeholder{display:grid;place-items:center;color:var(--muted);font-weight:700}
  .avatar-lg{width:120px;height:120px;border-radius:50%;object-fit:cover;background:#E9E9EB;box-shadow:inset 0 0 0 1px var(--border);flex:0 0 120px}
  .badges span{display:inline-block;background:#EAF2FF;color:#0A84FF;border-radius:999px;padding:4px 10px;margin-right:6px;font-weight:600}
  .note{color:var(--muted)}
  .clearable-file-input a,
  .clearable-file-input label[for$="-clear_id"],
  .clearable-file-input input[type="checkbox"]{display:none!important}
  #id_avatar{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0 0 0 0);white-space:nowrap;border:0}

   /* ===== Requests UI (—á/–± –º–∏–Ω–∏–º–∞–ª–∏–∑–º) ===== */
.rq-container { display: grid; gap: 16px; }
.rq-title { font-size: 22px; font-weight: 700; }
.rq-mono { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; }
.rq-meta { display:flex; gap:12px; flex-wrap:wrap; color:#666; margin-top:6px; align-items:center; }

.rq-chip { padding:2px 8px; border:1px solid #ddd; border-radius:999px; font-size:12px; color:#111; background:#fff; }
.rq-chip--submitted { border-color:#999; }
.rq-chip--approved { border-color:#222; background:#111; color:#fff; }
.rq-chip--to_pick { border-color:#111; }
.rq-chip--in_progress { border-color:#111; }
.rq-chip--ready_to_ship { border-color:#111; }
.rq-chip--done { border-color:#111; background:#111; color:#fff; }
.rq-chip--rejected, .rq-chip--canceled { border-color:#bbb; color:#777; }

.rq-steps { display:flex; gap:8px; padding:0; margin:4px 0 0; list-style:none; flex-wrap:wrap; }
.rq-step { padding:6px 10px; border:1px dashed #ddd; border-radius:10px; font-size:12px; color:#777; }
.rq-step.is-done { border-style:solid; border-color:#111; color:#111; }

.rq-actions { position: sticky; top: 0; background: var(--bg, #f6f6f8); padding: 8px 0; z-index: 5; }
.rq-actions__row { display:flex; gap:8px; flex-wrap:wrap; }

/* –ö–∞—Ä—Ç–æ—á–∫–∏ */
.rq-card { border:1px solid #e6e6ea; border-radius:12px; background:#fff; }
.rq-card__head { display:flex; align-items:center; justify-content:space-between; padding:12px 14px; border-bottom:1px solid #eee; }
.rq-card h2 { font-size:16px; font-weight:600; margin:0; }

/* –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ */
.rq-additem { display:grid; grid-template-columns: 1.5fr 120px 1fr auto; gap:8px; align-items:end; }
.rq-additem__field select, .rq-additem__qty input, .rq-additem__note input { width:100%; }

/* –¢–∞–±–ª–∏—Ü–∞ */
.rq-table { display:grid; }
.rq-trow { display:grid; grid-template-columns: 1.4fr 120px 1fr; gap:8px; padding:10px 14px; }
.rq-trow--head { background:#fafafa; border-bottom:1px solid #eee; font-weight:600; }
.rq-trow + .rq-trow { border-top:1px solid #f0f0f0; }
.ta-right { text-align:right; }
.muted { color:#777; }
.rq-empty { padding:16px; color:#999; }
</style>

  <script>
  // –æ—Ç–∫–ª—é—á–∞–µ–º reset –æ—Ç Tailwind, —á—Ç–æ–±—ã –Ω–µ —Å–±–∏–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∏–ª–∏
  tailwind = { config: { corePlugins: { preflight: false } } };
</script>
<script src="https://cdn.tailwindcss.com"></script>

  {% block extra_head %}{% endblock %}
</head>

<body>
  <header class="topbar">
     <div class="topbar-inner">
      <div style="display:flex;align-items:center;gap:12px;flex:1">
        <a href="{% url 'post_login_router' %}" class="brand" aria-label="–ù–∞ –≥–ª–∞–≤–Ω—É—é" style="display:flex;align-items:center;gap:10px;text-decoration:none;flex-shrink:0">
          <div class="brand-logo-wrapper">
            <img src="{% static 'img/log.png' %}" alt="IndigoFlow">
          </div>
          <span style="font-weight:700;font-size:18px;color:var(--text);display:none">IndigoFlow</span>
        </a>

        <!-- Mobile Menu Toggle -->
        <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="–ú–µ–Ω—é" aria-expanded="false">
          <span></span>
          <span></span>
          <span></span>
        </button>
        <span class="mobile-menu-label">–ú–µ–Ω—é</span>

        <!-- NAV: –ì–ª–∞–≤–Ω–∞—è / –¢–æ–≤–∞—Ä—ã -->
         {% with current=request.resolver_match.url_name %}
          <nav class="nav" id="mainNav">

  {# –û–ø–µ—Ä–∞—Ç–æ—Ä #}
  {% if request.user|in_groups:"operator" %}
    <a href="{% url 'operator_dashboard' %}"
       class="{% if request.resolver_match.url_name == 'operator_dashboard' %}active{% endif %}">
      <span>–û–ø–µ—Ä–∞—Ç–æ—Ä</span>
    </a>
  {% endif %}



  {# –ú–µ–Ω–µ–¥–∂–µ—Ä #}
  {% if request.user|in_groups:"manager" %}
    <a href="{% url 'manager_dashboard' %}"
       class="{% if request.resolver_match.url_name == 'manager_dashboard' %}active{% endif %}">
      <span>–ú–µ–Ω–µ–¥–∂–µ—Ä</span>
    </a>
  {% endif %}


            {# warehouse #}
  {% if request.user|in_groups:"warehouse" %}
    <a href="{% url 'warehouse_dashboard' %}"
       class="{% if request.resolver_match.url_name == 'warehouse_dashboard' %}active{% endif %}">
      <span>–ö–ª–∞–¥–æ–≤—â–∏–∫</span>
    </a>
  {% endif %}


  {# –£–ø—Ä–∞–≤–ª—è—é—â–∏–π #}
  {% if request.user|in_groups:"director" %}
    <a href="{% url 'director_dashboard' %}"
       class="{% if request.resolver_match.url_name == 'director_dashboard' %}active{% endif %}">
      <span>–£–ø—Ä–∞–≤–ª—è—é—â–∏–π</span>
    </a>
  {% endif %}

  {# –¢–æ–≤–∞—Ä—ã #}
  <a href="{% url 'product-list' %}"
     class="{% if request.resolver_match.url_name == 'product-list' %}active{% endif %}">
    <span>–¢–æ–≤–∞—Ä—ã</span>
  </a>
            {# –ó–∞—è–≤–∫–∏ #}
            {% if request.user.is_authenticated %}
  <a href="{% url 'core:request_list' %}"
     class="{% if 'request' in request.resolver_match.url_name %}active{% endif %}">
    <span>–ó–∞–∫–∞–∑—ã</span>
  </a>
{% endif %}



  {# –°–∫–ª–∞–¥ ‚Äî –∞–∫—Ç–∏–≤–µ–Ω –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö #}
  {% if request.user|in_groups:"warehouse,director" %}
    <a href="{% url 'warehouse_new_dashboard' %}"
       class="{% if 'warehouse' in request.resolver_match.url_name and request.resolver_match.url_name != 'warehouse_dashboard' %}active{% endif %}">
      <span>–°–∫–ª–∞–¥</span>
    </a>
  {% endif %}





  {# –ö–ª–∏–µ–Ω—Ç—ã #}
  {% if show_clients_link %}
    <a href="{% url 'core:counterparty_list' %}"
       class="{% if request.resolver_match.url_name == 'counterparty_list' %}active{% endif %}">
      <span>–ö–ª–∏–µ–Ω—Ç—ã</span>
    </a>
  {% endif %}

</nav>
        {% endwith %}
      </div>
      <div class="userbox">
        {% if request.user.is_authenticated %}
          {% if profile and profile.avatar %}
            <img src="{{ profile.avatar.url }}" class="avatar-sm" alt="avatar">
          {% else %}
            <div class="avatar-sm">
              {% firstof request.user.first_name|slice:":1"|upper request.user.username|slice:":1"|upper %}
            </div>
          {% endif %}

          <button class="userbtn" id="userMenuBtn" type="button" aria-haspopup="true" aria-expanded="false">
            <span class="hello">–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ,</span>
            <span class="name">{% firstof request.user.first_name request.user.username %}</span>
            <span class="caret">‚ñæ</span>
          </button>

          <div class="menu" id="userMenu">
            <a href="{% url 'profile' %}">üë§ –ü—Ä–æ—Ñ–∏–ª—å</a>
            <a href="{% url 'password_change' %}">üîí –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</a>
            <a href="{% url 'logout' %}">‚Ü™ –í—ã–π—Ç–∏</a>
          </div>
        {% else %}
          <a href="{% url 'login' %}">–í–æ–π—Ç–∏</a>
        {% endif %}
      </div>
    </div>
  </header>

<main class="wrap {% block wrap_mod %}{% endblock %}">
  {% block content %}{% endblock %}
</main>  <!-- –ù–ï –∑–∞–±—ã—Ç—å –∑–∞–∫—Ä—ã—Ç—å -->

  <script>
    (function(){
      // User menu toggle
      const btn = document.getElementById('userMenuBtn');
      const menu = document.getElementById('userMenu');
      if(btn && menu) {
        const toggle = () => { menu.classList.toggle('open'); };
        btn.addEventListener('click', (e)=>{ e.stopPropagation(); toggle(); });
        document.addEventListener('click', ()=>{ if(menu.classList.contains('open')) menu.classList.remove('open'); });
        document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') menu.classList.remove('open'); });
      }

      // Mobile menu toggle
      const mobileToggle = document.getElementById('mobileMenuToggle');
      const mainNav = document.getElementById('mainNav');
      if(mobileToggle && mainNav) {
        mobileToggle.addEventListener('click', function(e) {
          e.stopPropagation();
          this.classList.toggle('active');
          mainNav.classList.toggle('open');
          const isOpen = mainNav.classList.contains('open');
          this.setAttribute('aria-expanded', isOpen);
          
          // Prevent body scroll when menu is open
          if(isOpen) {
            document.body.style.overflow = 'hidden';
          } else {
            document.body.style.overflow = '';
          }
        });

        // Close menu when clicking outside
        document.addEventListener('click', function(e) {
          if(mainNav.classList.contains('open') && 
             !mainNav.contains(e.target) && 
             !mobileToggle.contains(e.target)) {
            mobileToggle.classList.remove('active');
            mainNav.classList.remove('open');
            mobileToggle.setAttribute('aria-expanded', 'false');
            document.body.style.overflow = '';
          }
        });

        // Close menu on escape
        document.addEventListener('keydown', function(e) {
          if(e.key === 'Escape' && mainNav.classList.contains('open')) {
            mobileToggle.classList.remove('active');
            mainNav.classList.remove('open');
            mobileToggle.setAttribute('aria-expanded', 'false');
            document.body.style.overflow = '';
          }
        });

        // Close menu when clicking a nav link (mobile)
        const navLinks = mainNav.querySelectorAll('a');
        navLinks.forEach(link => {
          link.addEventListener('click', function() {
            if(window.innerWidth <= 940) {
              mobileToggle.classList.remove('active');
              mainNav.classList.remove('open');
              mobileToggle.setAttribute('aria-expanded', 'false');
              document.body.style.overflow = '';
            }
          });
        });
      }
    })();
  </script>

  {% block extra_js %}{% endblock %}
<script src="https://unpkg.com/htmx.org@1.9.12"></script>

{# Flash messages #}
{% if messages %}
  <div id="flash-root" class="fixed top-4 right-4 z-[1000] space-y-2 w-[min(92vw,420px)]">
    {% for message in messages %}
      <div
        class="flash-item rounded-xl px-4 py-3 shadow ring-1 text-sm flex items-start gap-3
               {% if message.tags == 'error' %} bg-red-50 text-red-800 ring-red-200
               {% elif message.tags == 'warning' %} bg-amber-50 text-amber-900 ring-amber-200
               {% elif message.tags == 'success' %} bg-green-50 text-green-800 ring-green-200
               {% elif message.tags == 'info' %} bg-blue-50 text-blue-800 ring-blue-200
               {% else %} bg-gray-50 text-gray-800 ring-gray-200 {% endif %}">
        <div class="min-w-0 break-words">{{ message }}</div>
        <button type="button" class="ml-auto shrink-0 rounded-md px-2 py-1 text-xs opacity-70 hover:opacity-100"
                onclick="this.closest('.flash-item')?.remove()">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    {% endfor %}
  </div>
{% endif %}

<script>
  // –ê–≤—Ç–æ—Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
  (function () {
    const items = document.querySelectorAll('#flash-root .flash-item');
    items.forEach((el, idx) => {
      // –ª—ë–≥–∫–∞—è —Å—Ç—É–ø–µ–Ω—á–∞—Ç–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞, —á—Ç–æ–±—ã –Ω–µ –∏—Å—á–µ–∑–∞–ª–∏ –≤—Å–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
      const delay = 5000 + idx * 200;
      setTimeout(() => {
        el.style.transition = 'opacity .25s, transform .25s';
        el.style.opacity = '0';
        el.style.transform = 'translateY(-6px)';
        setTimeout(() => el.remove(), 300);
      }, delay);
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö –ø–æ Esc
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        document.querySelectorAll('#flash-root .flash-item').forEach(el => el.remove());
      }
    });
  })();
</script>
<footer class="footer" role="contentinfo" aria-label="–ù–∏–∂–Ω—è—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–∞–π—Ç–∞">
  <div class="footer-inner">
    <div>IndigoFlow ‚Äî —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å–æ–º ¬© 2025</div>
    <div>
      <a href="https://www.incodingo.pro" target="_blank" rel="noopener noreferrer">
        www.incodingo.pro
      </a>
    </div>
  </div>
</footer>
</body>
</html>
