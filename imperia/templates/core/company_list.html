{% extends "base.html" %}
{% load humanize %}

{% block title %}–ö–æ–º–ø–∞–Ω–∏–∏ ‚Äî IndigoFlow{% endblock %}

{% block content %}
<div class="card">
  <div class="card-header">
    <div>
      <h1 class="card-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏—è–º–∏</h1>
      <p class="card-subtitle">–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–º–ø–∞–Ω–∏–π –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</p>
    </div>
    <a href="{% url 'core:company_create' %}" class="btn btn-primary">
      + –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–∞–Ω–∏—é
    </a>
  </div>

  <!-- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã -->
  <div style="padding:20px;border-bottom:1px solid var(--border)">
    <form method="get" style="display:flex;gap:12px;flex-wrap:wrap;align-items:end">
      <div style="flex:1;min-width:200px">
        <label class="field label">–ü–æ–∏—Å–∫</label>
        <input 
          type="text" 
          name="q" 
          value="{{ search_query }}" 
          placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ, –ò–ù–ù..."
          class="input w-full"
        >
      </div>
      <div style="min-width:180px">
        <label class="field label">–°—Ç–∞—Ç—É—Å</label>
        <select name="active" class="input w-full">
          <option value="">–í—Å–µ</option>
          <option value="1" {% if active_filter == "1" %}selected{% endif %}>–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
          <option value="0" {% if active_filter == "0" %}selected{% endif %}>–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ</option>
        </select>
      </div>
      <button type="submit" class="btn btn-secondary">–ò—Å–∫–∞—Ç—å</button>
      {% if search_query or active_filter %}
        <a href="{% url 'core:company_list' %}" class="btn">–°–±—Ä–æ—Å–∏—Ç—å</a>
      {% endif %}
    </form>
  </div>

  <!-- –°–ø–∏—Å–æ–∫ –∫–æ–º–ø–∞–Ω–∏–π -->
  <div style="padding:20px">
    {% if companies %}
      <div style="display:grid;gap:12px">
        {% for company in companies %}
          <div style="padding:16px;background:var(--bg);border:1px solid var(--border);border-radius:12px;display:flex;justify-content:space-between;align-items:center;gap:16px;flex-wrap:wrap">
            <div style="flex:1;min-width:200px">
              <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
                <h3 style="margin:0;font-size:16px;font-weight:600">{{ company.name }}</h3>
                {% if not company.is_active %}
                  <span style="padding:2px 8px;background:#fee2e2;border:1px solid #fecaca;border-radius:4px;font-size:11px;color:#7f1d1d">–ù–µ–∞–∫—Ç–∏–≤–Ω–∞</span>
                {% endif %}
              </div>
              {% if company.full_name %}
                <div style="font-size:13px;color:var(--muted);margin-bottom:4px">{{ company.full_name }}</div>
              {% endif %}
              <div style="font-size:12px;color:var(--muted);font-family:monospace">
                –ò–ù–ù: {{ company.inn }}{% if company.kpp %} / –ö–ü–ü: {{ company.kpp }}{% endif %}
              </div>
              {% if company.address %}
                <div style="font-size:12px;color:var(--muted);margin-top:4px">{{ company.address|truncatewords:10 }}</div>
              {% endif %}
            </div>
            <div style="display:flex;gap:8px;flex-shrink:0">
              <a href="{% url 'core:company_edit' company.pk %}" class="btn btn-secondary" style="padding:8px 16px;font-size:13px">
                –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
              </a>
              <form method="post" action="{% url 'core:company_delete' company.pk %}" style="display:inline" onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∫–æ–º–ø–∞–Ω–∏—é {{ company.name }}?');">
                {% csrf_token %}
                <button type="submit" class="btn" style="padding:8px 16px;font-size:13px;background:#fee2e2;border-color:#fecaca;color:#7f1d1d">
                  –£–¥–∞–ª–∏—Ç—å
                </button>
              </form>
            </div>
          </div>
        {% endfor %}
      </div>

      <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
      {% if companies.has_other_pages %}
        <div style="margin-top:24px;display:flex;justify-content:center;gap:8px;flex-wrap:wrap">
          {% if companies.has_previous %}
            <a href="?page={{ companies.previous_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if active_filter %}&active={{ active_filter }}{% endif %}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥</a>
          {% endif %}
          <span style="padding:8px 16px;display:flex;align-items:center;color:var(--muted)">
            –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ companies.number }} –∏–∑ {{ companies.paginator.num_pages }}
          </span>
          {% if companies.has_next %}
            <a href="?page={{ companies.next_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if active_filter %}&active={{ active_filter }}{% endif %}" class="btn btn-secondary">–í–ø–µ—Ä–µ–¥ ‚Üí</a>
          {% endif %}
        </div>
      {% endif %}
    {% else %}
      <div style="padding:40px;text-align:center;color:var(--muted)">
        <div style="font-size:48px;margin-bottom:16px">üè¢</div>
        <div style="font-size:18px;font-weight:600;margin-bottom:8px">–ö–æ–º–ø–∞–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>
        <div style="font-size:14px">
          {% if search_query or active_filter %}
            –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞
          {% else %}
            –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –∫–æ–º–ø–∞–Ω–∏—é –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
          {% endif %}
        </div>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}

