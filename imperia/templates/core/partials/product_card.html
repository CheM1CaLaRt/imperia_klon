{# НЕ требуется итерировать related manager'ы — приходят готовые списки #}
<div class="grid md:grid-cols-2 gap-6">
  <div>
    <div class="aspect-square w-full overflow-hidden rounded-2xl ring-1 ring-gray-200 bg-white flex items-center justify-center">
      {% if gallery and gallery.0 %}
        <img id="pc-main" src="{{ gallery.0 }}" alt="{{ product.name }}" class="max-h-full max-w-full object-contain">
      {% else %}
        <div class="text-gray-400">Нет изображения</div>
      {% endif %}
    </div>

    {% if gallery|length > 1 %}
      <div class="mt-3 flex gap-2 overflow-x-auto">
        {% for img in gallery %}
          <button
            type="button"
            class="shrink-0 h-16 w-16 rounded-xl ring-1 ring-gray-200 overflow-hidden hover:ring-gray-300"
            data-full="{{ img }}"
            onclick="
              const main = document.getElementById('pc-main');
              if (main) main.src=this.dataset.full;
              this.closest('.mt-3').querySelectorAll('button').forEach(b=>b.classList.remove('ring-2','ring-blue-500'));
              this.classList.add('ring-2','ring-blue-500');
            ">
            <img src="{{ img }}" alt="" class="h-full w-full object-cover">
          </button>
        {% endfor %}
      </div>
    {% endif %}
  </div>

  <div class="space-y-4">
    <h3 class="text-2xl font-semibold leading-snug">{{ product.name }}</h3>

    <div class="text-sm text-gray-500 space-x-2">
      {% if product.brand %}<span class="uppercase tracking-wide">{{ product.brand }}</span>{% endif %}
      {% if product.sku %}<span class="text-gray-400">•</span><span class="font-mono">{{ product.sku }}</span>{% endif %}
    </div>

    <div class="text-sm text-gray-600">
      {% if product.barcode %}<div>Штрихкод: <span class="font-mono">{{ product.barcode }}</span></div>{% endif %}
      {% if product.vendor %}<div>Поставщик: <span class="font-medium">{{ product.vendor }}</span></div>{% endif %}
    </div>

    {% if price_min %}
      <div class="text-lg font-semibold">{{ price_min|floatformat:2 }} ₽</div>
    {% endif %}

    {% if product.description %}
      <div>
        <div class="text-sm font-medium mb-1">Описание</div>
        <div class="prose max-w-none prose-sm">{{ product.description|linebreaksbr }}</div>
      </div>
    {% endif %}

    {% if attrs %}
      <div>
        <div class="text-sm font-medium mb-2">Характеристики</div>
        <div class="grid grid-cols-2 gap-2">
          {% for name, value in attrs %}
            <div class="rounded-xl bg-gray-50 p-3">
              <div class="text-xs text-gray-500">{{ name }}</div>
              <div class="text-sm font-medium break-words">{{ value }}</div>
            </div>
          {% endfor %}
        </div>
      </div>
    {% endif %}

    {% if product.length_cm or product.width_cm or product.height_cm or product.weight_kg or product.volume_m3 %}
      <div class="rounded-xl border p-3">
        <div class="text-sm font-medium mb-2">Габариты</div>
        <div class="flex flex-wrap gap-3 text-sm">
          {% if product.length_cm and product.width_cm and product.height_cm %}
            <div class="px-2 py-1 rounded-lg bg-gray-50">{{ product.length_cm }} × {{ product.width_cm }} × {{ product.height_cm }} см</div>
          {% endif %}
          {% if product.weight_kg %}<div class="px-2 py-1 rounded-lg bg-gray-50">Вес: {{ product.weight_kg }} кг</div>{% endif %}
          {% if product.volume_m3 %}<div class="px-2 py-1 rounded-lg bg-gray-50">Объём: {{ product.volume_m3 }} м³</div>{% endif %}
        </div>
      </div>
    {% endif %}

    {% if certificates %}
      <details class="rounded-xl border p-3">
        <summary class="cursor-pointer text-sm font-medium select-none">Сертификаты</summary>
        <ul class="mt-2 space-y-1 text-sm list-disc pl-5">
          {% for cert in certificates %}
            {% if cert.url %}
              <li><a href="{{ cert.url }}" target="_blank" class="link">{{ cert.name|default:"Сертификат" }}</a></li>
            {% else %}
              <li>{{ cert.name }}</li>
            {% endif %}
          {% endfor %}
        </ul>
      </details>
    {% endif %}

    {% if product.updated_at %}
      <div class="text-xs text-gray-400">Обновлено: {{ product.updated_at|date:"d.m.Y H:i" }}</div>
    {% endif %}
  </div>
</div>
