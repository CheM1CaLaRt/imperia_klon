{% extends "base.html" %}
{% load access %}
{% load humanize %}

{% block title %}–°–∫–ª–∞–¥ ‚Äî –ø–∞–Ω–µ–ª—å{% endblock %}
{% block content %}

<div class="card">
  <div class="card-header">
    <div>
      <h1 class="card-title">–°–∫–ª–∞–¥—ã</h1>
      <p class="card-subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫–ª–∞–¥–∞–º–∏ –∏ —Ç–æ–≤–∞—Ä–∞–º–∏</p>
    </div>
    {% if request.user|in_groups:"director" %}
      <a href="{% url 'warehouse_create' %}" class="btn btn-primary">+ –ù–æ–≤—ã–π —Å–∫–ª–∞–¥</a>
    {% endif %}
  </div>
</div>

{% if warehouses %}
  <div class="grid grid-3">
    {% for w in warehouses %}
      <a href="{% url 'warehouse_detail' w.pk %}" class="stat-card" style="text-align:left;text-decoration:none;color:inherit">
        <div style="font-size:14px;color:var(--muted);text-transform:uppercase;letter-spacing:0.5px;margin-bottom:8px">–°–∫–ª–∞–¥</div>
        <div style="font-size:20px;font-weight:700;color:var(--text);margin-bottom:8px">{{ w.code }}</div>
        <div style="font-size:16px;color:var(--text);margin-bottom:12px">{{ w.name }}</div>
        {% if w.address %}
          <div style="font-size:13px;color:var(--muted);margin-bottom:16px">{{ w.address|truncatewords:8 }}</div>
        {% endif %}
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;padding-top:16px;border-top:1px solid var(--border);font-size:13px">
          <div>
            <div style="color:var(--muted)">–Ø—á–µ–µ–∫</div>
            <div style="font-weight:600;font-size:16px;color:var(--primary)">{{ w.bins_count|default:0 }}</div>
          </div>
          <div>
            <div style="color:var(--muted)">–ü–æ–∑–∏—Ü–∏–π</div>
            <div style="font-weight:600;font-size:16px;color:var(--primary)">{{ w.inv_positions|default:0 }}</div>
          </div>
        </div>
        <div style="margin-top:12px">
          <span class="btn btn-primary" style="width:100%;font-size:14px;padding:8px 16px">–û—Ç–∫—Ä—ã—Ç—å —Å–∫–ª–∞–¥</span>
        </div>
      </a>
    {% endfor %}
  </div>
{% else %}
  <div class="card">
    <div style="padding:48px 24px;text-align:center;color:var(--muted)">
      <div style="font-size:48px;margin-bottom:12px">üì¶</div>
      <div style="font-size:18px;font-weight:600;margin-bottom:4px;color:var(--text)">–°–∫–ª–∞–¥—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>
      <div style="font-size:14px">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π —Å–∫–ª–∞–¥ –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã</div>
    </div>
  </div>
{% endif %}

{% if recent_moves %}
  <div class="card" style="margin-top:24px">
    <h2 style="font-size:20px;font-weight:700;margin:0 0 20px 0;padding-bottom:16px;border-bottom:1px solid var(--border)">–ù–µ–¥–∞–≤–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è</h2>
    <div style="overflow-x:auto">
      <table style="width:100%;border-collapse:collapse">
        <thead>
          <tr style="background:var(--bg);border-bottom:2px solid var(--border)">
            <th style="padding:12px;text-align:left;font-weight:600;font-size:13px;color:var(--muted);text-transform:uppercase">–í—Ä–µ–º—è</th>
            <th style="padding:12px;text-align:left;font-weight:600;font-size:13px;color:var(--muted);text-transform:uppercase">–¢–∏–ø</th>
            <th style="padding:12px;text-align:left;font-weight:600;font-size:13px;color:var(--muted);text-transform:uppercase">–°–∫–ª–∞–¥</th>
            <th style="padding:12px;text-align:left;font-weight:600;font-size:13px;color:var(--muted);text-transform:uppercase">–ò–∑</th>
            <th style="padding:12px;text-align:left;font-weight:600;font-size:13px;color:var(--muted);text-transform:uppercase">–í</th>
            <th style="padding:12px;text-align:left;font-weight:600;font-size:13px;color:var(--muted);text-transform:uppercase">–¢–æ–≤–∞—Ä</th>
            <th style="padding:12px;text-align:left;font-weight:600;font-size:13px;color:var(--muted);text-transform:uppercase">–ö–æ–ª-–≤–æ</th>
            <th style="padding:12px;text-align:left;font-weight:600;font-size:13px;color:var(--muted);text-transform:uppercase">–ö—Ç–æ</th>
          </tr>
        </thead>
        <tbody>
          {% for m in recent_moves %}
            <tr style="border-bottom:1px solid var(--border);transition:background 0.2s" onmouseover="this.style.background='var(--bg)'" onmouseout="this.style.background='transparent'">
              <td style="padding:12px;font-size:13px;color:var(--muted)">{{ m.timestamp|date:"d.m.Y H:i" }}</td>
              <td style="padding:12px;font-size:14px">{{ m.get_movement_type_display }}</td>
              <td style="padding:12px;font-size:14px;font-weight:600">{{ m.warehouse.code }}</td>
              <td style="padding:12px;font-size:14px;font-family:ui-monospace">{% if m.bin_from %}{{ m.bin_from.code }}{% else %}‚Äî{% endif %}</td>
              <td style="padding:12px;font-size:14px;font-family:ui-monospace">{% if m.bin_to %}{{ m.bin_to.code }}{% else %}‚Äî{% endif %}</td>
              <td style="padding:12px">
                <div style="font-family:ui-monospace;font-size:13px;font-weight:600">{{ m.product.barcode }}</div>
                <div style="font-size:13px;color:var(--muted)">{{ m.product.name|truncatewords:5 }}</div>
              </td>
              <td style="padding:12px;font-size:14px;font-weight:600">{{ m.quantity|floatformat:0 }}</td>
              <td style="padding:12px;font-size:13px;color:var(--muted)">{{ m.actor|default:"‚Äî" }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endif %}

<style>
@media (max-width:940px){
  .grid-3{grid-template-columns:1fr}
  .stat-card:hover{transform:none}
}
@media (max-width:640px){
  .card table{font-size:12px}
  .card th,.card td{padding:8px}
  .card thead{display:none}
  .card tbody tr{display:block;margin-bottom:16px;border:1px solid var(--border);border-radius:12px;padding:12px}
  .card tbody td{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--bg)}
  .card tbody td:before{content:attr(data-label);font-weight:600;color:var(--muted)}
  .card tbody td:last-child{border-bottom:0}
}
</style>
{% endblock %}
